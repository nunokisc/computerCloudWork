<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>Gestão de Containers...</title>

  <!-- Bootstrap core CSS -->
  <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom styles for this template -->
  <link href="css/simple-sidebar.css" rel="stylesheet">

</head>

<body>

  <div class="d-flex" id="wrapper">

    <!-- Sidebar -->
    <div class="bg-light border-right" id="sidebar-wrapper">
      <div class="sidebar-heading">Start Bootstrap </div>
      <div class="list-group list-group-flush">
          <a href="#" class="list-group-item list-group-item-action bg-light">Dashboard</a>
          <a href="index1.html" class="list-group-item list-group-item-action bg-light">Gestão Containers</a>
      </div>
    </div>
    <!-- /#sidebar-wrapper -->

    <!-- Page Content -->
    <div id="page-content-wrapper">

      <nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom">
        <button class="btn btn-primary" id="menu-toggle">Toggle Menu</button>

        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav ml-auto mt-2 mt-lg-0">
            <li class="nav-item active">
              <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">Link</a>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Dropdown
              </a>
              <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                <a class="dropdown-item" href="#">Action</a>
                <a class="dropdown-item" href="#">Another action</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="#">Something else here</a>
              </div>
            </li>
          </ul>
        </div>
      </nav>
    <div>
      <div class="container-fluid">
        <h1 class="mt-12">Metricas</h1>
        <div style="margin-top:20px;" class="row" id="row1">
        </div>
        <div style="margin-top:20px;" class="row" id="row2">
        </div>
        <div style="margin-top:20px;" class="row" id="row3">
        </div>


        <div style="margin-top:20px;" class="row">
          <div class="col-6">
            <h1 class="mt-6">Nodes</h1>
            <table style="width:200; border:2px solid black; border-collapse:collapse;" id='thetable'>
              <tr style="border:1px solid black">
                <th style="border:1px solid black">Name</th>
                <th>Ip</th>
                <th>hostnames</th>
              </tr>
            </table> 
          </div>
          <div class="col-6">
            <h1 class="mt-6">Online Nginx Node</h1>
            <table style="width:200; border:2px solid black; border-collapse:collapse" id='thetable3'>
              <tr style="border:1px solid black">
                <th style="border:1px solid black">Name</th>
                <th>Ip</th>
              </tr>
            </table> 
          </div>
          <div class="col-6">
            <h1 class="mt-6">Online Root Containers</h1>
            <table style="width:200; border:2px solid black; border-collapse:collapse" id='thetable4'>
              <tr style="border:1px solid black">
                <th style="border:1px solid black">Name</th>
                <th>Ip</th>
              </tr>
            </table> 
          </div>
          <div class="col-6">
            <h1 class="mt-6">Ips</h1>
            <table style="width:200; border:2px solid black; border-collapse:collapse" id='thetable2'>
              <tr style="border:1px solid black">
                <th>Ip</th>
              </tr>
            </table> 
          </div>
          <div class="col-6">
          	<h1>Requests Por Segundo</h1><br>
          	<p><span id='req'></span></p>
          </div>
          <div class="col-6">
          	<h1>Requests Limit to Spawn</h1><br>
          	<p><span id='reqSpawn'></span></p>
          </div>
          <div class="col-6">
          	<h1>Req.Limit to Spawn Propagation</h1><br>
          	<p><span id='reqSpawnProp'></span></p>
          </div>
          <div class="col-6">
          	<h1>Connection Limit to Spawn</h1><br>
          	<p><span id='conSpawn'></span></p>
          </div>
          <div class="col-6">
          	<h1>Connection Limit to Spawn</h1><br>
          	<p><span id='conSpawnProp'></span></p>
          </div>
        </div>
      </div>


  </div>
  <!-- /#page-content-wrapper -->

</div>
<!-- /#wrapper -->

<!-- Bootstrap core JavaScript -->
<script src="vendor/jquery/jquery.min.js"></script>
<script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

<!-- Menu Toggle Script -->
<script>
  $("#menu-toggle").click(function(e) {
    e.preventDefault();
    $("#wrapper").toggleClass("toggled");
  });
</script>

<script src="/socket.io/socket.io.js"></script>
<script>
 var socket = io();

 socket.emit('getOnlineContainers','');
 socket.emit('getOnlineNginxNodeContainers','');
 socket.emit('getRootContainers','');
 socket.emit('getUsedIps','');
 socket.emit('getRequestsPerSecond','');
 socket.emit('getRequestsLimitToSpawn','');
 socket.emit('getRequestsLimitToSpawnPropagation','');
 socket.emit('getConnectionsLimitToSpawn','');
 socket.emit('getConnectionsLimitToSpawnPropagation','');

 socket.on('getOnlineContainers', function(msg) {
   console.log(msg);

   $('#thetable tr').not(':first').not(':last').remove();
   var html = '';
   for(var i = 0; i < msg.length; i++){
   	if(msg[i].name.substring(0,9)=='cwc-nginx'){
   		//if(msg[i].name=='cwc-nginxlb-master')
   			//showGrafanaIframe(msg[i].hostname);
   		html += '<tr style="border:1px solid black"><td>' + msg[i].name + 
   		'</td><td style="border:1px solid black">' + msg[i].ip + '</td><td style="border:1px solid black"> <a href="#" onclick="showGrafanaIframe(\''+msg[i].hostname+'\');" >' + msg[i].hostname + '</a></td></tr>';
   	}
   	else {
   		html += '<tr style="border:1px solid black"><td>' + msg[i].name + '</td><td style="border:1px solid black">' + msg[i].ip + '</td><td style="border:1px solid black"> ' + msg[i].hostname + '</td></tr>';

   	}
   	
   }
    
  $('#thetable tr').first().after(html);

})

 socket.on('getUsedIps',function(msg){
  console.log(msg);

    $('#thetable2 tr').not(':first').not(':last').remove();
   var html = '';
   for(var i = 0; i < msg.length; i++)
    html += '<tr style="border:1px solid black"><td>' + msg[i] + '</td></tr>';
  $('#thetable2 tr').first().after(html);
})

socket.on('getOnlineNginxNodeContainers',function(msg){
  console.log(msg);

    $('#thetable3 tr').not(':first').not(':last').remove();
   var html = '';
   for(var i = 0; i < msg.length; i++)
     html += '<tr style="border:1px solid black"><td>' + msg[i].name + '</td><td style="border:1px solid black">' + msg[i].ip + '</td></tr>';
  $('#thetable3 tr').first().after(html);
})

socket.on('getRootContainers',function(msg){
  console.log(msg);

    $('#thetable4 tr').not(':first').not(':last').remove();
   var html = '';
   for(var i in msg)
     html += '<tr style="border:1px solid black"><td>' + msg[i].name + '</td><td style="border:1px solid black">' + msg[i].ip + '</td></tr>';
  $('#thetable4 tr').first().after(html);
})


socket.on('getRequestsPerSecond',function(msg){
  console.log(msg);

    $('#req').html(msg);
})

socket.on('getRequestsLimitToSpawn',function(msg){
  console.log(msg);

    $('#reqSpawn').html(msg);
})

socket.on('getRequestsLimitToSpawnPropagation',function(msg){
  console.log(msg);

    $('#reqSpawnProp').html(msg);
})

socket.on('getConnectionsLimitToSpawn',function(msg){
  console.log(msg);

    $('#conSpawn').html(msg);
})

socket.on('getConnectionsLimitToSpawnPropagation',function(msg){
  console.log(msg);

    $('#conSpawnProp').html(msg);
})



 function createIframe(host,hostname,panelId,col){
  return ' <iframe class="col-'+col+'" src="http://'+host+':3001/d-solo/GqFjuAgmk/nginx?orgId=1&refresh=5s&var-datasource=InfluxDB&panelId='+panelId+'&from=now-1h&to=now&var-host='+hostname+'"  frameborder="0"></iframe>';
 }

  function createIframe2(host,hostname,panelId,col){
  return ' <iframe class="col-'+col+'" src="http://'+host+':3001/d-solo/GqFjuAgmk/nginx?orgId=1&refresh=5s&var-datasource=InfluxDB&panelId='+panelId+'&from=now-1h&to=now&var-host='+hostname+'"  frameborder="0"></iframe>';
 }

  function createIframe3(host,hostname,panelId,col){
  return ' <iframe class="col-'+col+'" src="http://'+host+':3001/d-solo/GqFjuAgmk/nginx?orgId=1&refresh=5s&var-datasource=InfluxDB&panelId='+panelId+'&from=now-1h&to=now&var-host='+hostname+'"  frameborder="0"></iframe>';
 }

 function showGrafanaIframe(hostname){
  console.log(hostname)
  let host = $(location).attr('hostname');
  let panelId = 1;
  let col = 3;
  $("#row1").html("");
  $("#row2").html("");
  $("#row3").html("");
  for (let i = 1; i <= 4; i++) {
      $("#row1").append(createIframe(host,hostname,i,3));
  }
  for (let i = 5; i <= 7; i=i+2) {
      $("#row2").append(createIframe2(host,hostname,i,6));
  }
  $("#row3").append(createIframe3(host,hostname,8,12));
  $("#row3").append(createIframe3(host,hostname,31,12));
  $("#row3").append(createIframe3(host,hostname,32,12));
 }
</script>


</body>

</html>
